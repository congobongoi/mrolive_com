<!DOCTYPE html>
{% load static %}
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRO Live Lot Inspection - Where Productivity Takes Flight</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}"/>
    <link rel="stylesheet" href="{% static 'dist/assets/css/app.css' %}">
    <link href="{% static 'dist/assets/fontawesome/css/all.css' %}" rel="stylesheet">
	<script type="text/javascript" src="{% static 'jquery-1.12.4.js' %}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script type="text/javascript" src="{% static 'jquery_tab_submit.js' %}"></script>
    <script type="text/javascript" src="{% static 'field_focus.js' %}"></script>
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2017.2.621/styles/kendo.common-material.min.css" />
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2017.2.621/styles/kendo.material.min.css" />
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2017.2.621/styles/kendo.material.mobile.min.css" />
    <script src="https://kendo.cdn.telerik.com/2020.1.114/js/jszip.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.4.0/jszip.js"></script>
    <script src="https://kendo.cdn.telerik.com/2017.2.621/js/jquery.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2017.2.621/js/kendo.all.min.js"></script>
	<!--script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script-->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker.min.css" rel="stylesheet"/>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<style>
 		textarea {
		    width: 560px;
            height: 20px !important;
		}
	    .subhead {
			color:white;
			text-decoration:bold;
			font-size: large;
            margin-left: 65px;
		}
        .k-pager-wrap .k-dropdown {
            width: 100px;	    
        }
		.k-grid-toolbar { 
			background-color:#284a8a !important;
			
		}
		.secondary.button::after {
		    content: none;
		}
		.button::after {
		    content: none;
		}
		.k-button {  
			border: 2px solid white;
			color: white;
			border-color: white !important;			
		}
		.k-button:hover {
		    color: yellow !important;
		}
		.k-button:visited {
		    color: white !important;
		}
		.centered {
		  /*top: 50%;*/
		  left: 50%;
		  height: 100%;
		  /* bring your own prefixes */
		  transform: translateX(-50%);
		}
		.total_rows {
		 padding-left:5px;
		 display:inline;
		 text-align:left;
		 border:none;
		 outline:none;
		 background-color:#284a8a!important;
		 color:white;
		 text-decoration:bold;
		 height:25px;
		 width: 45px;
		}
		.sel_rows {
        display:inline;
		text-align:right;
		border:none;
		outline:none;
		background-color:#284a8a!important;
		color:white;
		text-decoration:bold;
		height:25px;
		width: 55px;
		}
		.counter_wrap {
		width:auto;
		float:right;
		margin-top:-45px;
		margin-bottom: 5px;
		z-index:1000!important;
		color: white;
		}
        .loader,
        .loader:after {
            border-radius: 50%;
            width: 10em;
            height: 10em;
        }
        .loader {            
            margin: 60px auto;
            font-size: 10px;
            position: relative;
            text-indent: -9999em;
            border-top: 1.1em solid rgba(255, 255, 255, 0.2);
            border-right: 1.1em solid rgba(255, 255, 255, 0.2);
            border-bottom: 1.1em solid rgba(255, 255, 255, 0.2);
            border-left: 1.1em solid #ffffff;
            -webkit-transform: translateZ(0);
            -ms-transform: translateZ(0);
            transform: translateZ(0);
            -webkit-animation: load8 1.1s infinite linear;
            animation: load8 1.1s infinite linear;
        }
        @-webkit-keyframes load8 {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }
        @keyframes load8 {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }
        #loadingDiv {
            position:absolute;;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background-color:#000;
        }
    </style>
  </head>
  <body>
    <audio src="{% static 'error-trombone.mp3' %}" id="sad_trombone"></audio>
    <script type="text/javascript">
	function getDataListSelectedOption(txt_input, data_list_options) {
		var shownVal = document.getElementById(txt_input).value;
		var value2send = document.querySelector("#" + data_list_options + " option[value='" + shownVal + "']").dataset.value;
		return value2send;
	}
	$(document).ready(
		function () {
		error = $("#error").val();
		if (error) {
		   $("#sad_trombone").get(0).play();
		}
		var printDiag= $("#print_diag");
		var mgmtForm = $("#mgmt_form");
		mgmtForm.on("change", "#task_selector", function(evt){
            var val = $('#task_selector').val();
			//console.log('wot_auto_key: ' + val);
			//var wot_checked = $('#task_list option:checked').attr('data-id');
			//var wot_auto_key = $('#task_list option').find(':selected').attr('data-id');
			//var xyz = $('#task_list option').filter(function() {
			//	return this.value == val;
			//}).data('value');
			//console.log('wot_auto_key zyx: ' + val+ ' wot_checked: ' + wot_checked);
			var wot_auto_key = $("#task_list option[value='" + $('#task_selector').val() + "']").attr('data-id')
            //console.log(wot_auto_key);
			$('#task_sel').val(wot_auto_key);
							    
		});
  
		$("input").click(function(e){
		    var id_clicked = e.target.id;
   
								   
						   
							 
							 
											  
					   
	
   
			if (id_clicked == 'yes_button') {
				//e.preventDefault();				
				$('#yes_print').val('1');
						 
				$('body').append('<div style="" id="loadingDiv"><div class="loader">Loading...</div></div>');
				$(window).on('load', function(){
					setTimeout(removeLoader, 0); //wait for page load PLUS two seconds.
				});						   
				printDiag.submit();	
			}
			
			if (id_clicked == 'lot_search') {
						 
				$('body').append('<div style="" id="loadingDiv"><div class="loader">Loading...</div></div>');
				$(window).on('load', function(){
					setTimeout(removeLoader, 0); //wait for page load PLUS two seconds.
				});						   

				e.preventDefault();				
				$('#is_search').val('1');
				mgmtForm.submit();	
			}
			
			if (id_clicked == 'update' || id_clicked == 'bottom_update') {
						 
				$('body').append('<div style="" id="loadingDiv"><div class="loader">Loading...</div></div>');
				$(window).on('load', function(){
					setTimeout(removeLoader, 0); //wait for page load PLUS two seconds.
				});						   

				e.preventDefault();				
				$('#is_update').val('1');
				mgmtForm.submit();	
			}
			
			if (id_clicked == 'accept' || id_clicked == 'bottom_accept') {
						 
				$('body').append('<div style="" id="loadingDiv"><div class="loader">Loading...</div></div>');
				$(window).on('load', function(){
					setTimeout(removeLoader, 0); //wait for page load PLUS two seconds.
				});						   

				e.preventDefault();				
				$('#is_accept').val('1');
				mgmtForm.submit();	
			}

		});
	})
    </script>
<div class="mro-header-wrapper">
	<section id="mrotop"></section>
	<div class="grid-container mro-header">
		<div class="grid-x medium-margin-collapse align-middle hide-for-medium" style="float:left;">
			<div class="cell large-1 medium-2 small-12 mro-menu-button">
				<a data-toggle="offCanvas"><i class="fas fa-bars"></i></a>
			</div>
			<div class="cell large-11 medium-10 small-12 show-for-medium"><hr/></div>
		</div>
		<div class="grid-x grid-padding-x align-middle">
			<div class="cell medium-7 small-12 mro-headerlogo">
				<a href="" alt="MRO Live - Homepage">
					<img style="max-width:361px;max-height:150px;" src="{% static 'dist/assets/img/mro-live_header.png' %}" alt="MROLive - Where Productivity Takes Flight">
				</a>
			</div>
			<!--div class="cell medium-5 small-12 mro-clientlogo show-for-medium">
				<a href="#" alt="MRO Live - Client Logo">
				  <img style="max-width:150px;" src="../../..{{ logo_url }}" alt="{{ user_name }}">
				</a>			
			</div-->
		</div>
		<div class="grid-x medium-margin-collapse align-middle show-for-medium">
			<div class="cell large-1 medium-2 small-12 mro-menu-button">
				<a data-toggle="offCanvas">Menu <i class="fas fa-bars"></i></a>
			</div>
			<div class="cell large-11 medium-10 small-12 show-for-medium"><hr/></div>
		</div>
		<!--div class="cell medium-7 small-12 mro-clientlogo hide-for-medium mro-mobileclient">
			  <a href="#" alt="MRO Live - Client Logo">
				<img style="max-width:150px;" src="../../..{{ logo_url }}" alt="{{ user_name }}">
			  </a>      
		</div-->
	</div>
</div>

<!-- Off-canvas Menu -->

<div class="off-canvas position-left" id="offCanvas" data-off-canvas>

<!-- Close button -->
<button class="close-button" aria-label="Close menu" type="button" data-close>
  <span aria-hidden="true">&times;</span>
</button>
<!-- Menu -->
<ul class="vertical mro-menu menu">
	<li class="mro-menu-logo">
		<a href="http://mrolive.com/" target="_blank">
			<img src="{% static 'dist/assets/img/MROlive-logo.png' %}" alt="Where Productivity Takes Flight" alt="MRO Live - Where Productivity Takes Flight">
		</a>
	</li>
	{% if op_apps %}
	<div class="subhead">Operations</div>
	{% endif %}
	{% for app in op_apps %}
      <li><a target="_blank" href="http://18.188.56.36:8029/portal/{{ app.ml_apps_id.code }}/{{ quapi_id }}">{{ app.ml_apps_id.name }}</a></li>
    {% endfor %}
	{% if mgmt_apps %}
	<div class="subhead">Management</div>
	{% endif %}
	{% for app in mgmt_apps %}
      <li><a target="_blank" href="http://18.188.56.36:8029/portal/{{ app.ml_apps_id.code }}/{{ quapi_id }}">{{ app.ml_apps_id.name }}</a></li>
    {% endfor %}
	{% if dash_apps %}
	<div class="subhead">Dashboards</div>
	{% endif %}
	{% for app in dash_apps %}
      <li><a target="_blank" href="http://18.188.56.36:8029/portal/{{ app.ml_apps_id.code }}/{{ quapi_id }}">{{ app.ml_apps_id.name }}</a></li>
    {% endfor %}
	{% if setup_apps %}
	<div class="subhead">Setup</div>
	{% endif %}
	{% for app in setup_apps %}
      <li><a target="_blank" href="http://18.188.56.36:8029/portal/{{ app.ml_apps_id.code }}/{{ quapi_id }}">{{ app.ml_apps_id.name }}</a></li>
    {% endfor %}
	<li><a href="/portal/pass-reset/">Reset Password</a></li>
    <li><a href="/login">Logout</a></li>
</ul>
</div>
<!-- Off-canvas Menu - END -->
    <div class="grid-container mro-top-section">
      <div class="grid-x grid-padding-x">
          <div class="mro-top-section-wrapper mro-search">
			<form method="POST" id="mgmt_form" name="mgmt_form" enctype="multipart/form-data" onsubmit='setFocusToTextBox()'>
			  <input type="hidden" name="task_sel" id="task_sel"/>
			  <input type="hidden" name="already_printed" id="already_printed" value="{{ already_printed }}"/>
			  <input type="hidden" name="bom_statuses" id="bom_statuses"/>
			  <input type="hidden" name="stock_stat" id="stock_stat" value="{{stock_status}}"/>
			  <input type="hidden" name="clear_form" id="clear_form" value="0"/>
			  <input type="hidden" name="is_search" id="is_search" value="0"/>
			  <input type="hidden" name="is_update" id="is_update" value="0"/>
			  <input type="hidden" name="is_accept" id="is_accept" value="0"/>
			  <input type="hidden" name="aut_print" id="aut_print" value="0"/>
			  <input type="hidden" name="not_print" id="not_print" value="0"/>
			  <input type="hidden" name="session_id" id="session_id" value="{{session_id}}"/>
			  <input type="hidden" type="text" name="upd_pn" id="upd_pn" value="{{upd_pn}}"/>
			  <input type="hidden" type="text" name="upd_desc" id="upd_desc" value="{{upd_desc}}"/>
			  <input type="hidden" type="text" name="upd_cons" id="upd_cons" value="{{upd_cons}}"/>
            <div class="mro-top-section" style="width:100%;">
              <div class="mro-lightsearch">
			    <div class="medium-12 small-7 cell hide-for-medium">
				</div>
				<div class="medium-12 small-7 cell hide-for-medium">
				</div>
				<div class="cell large-4 medium-6 small-12">
				  <h1>Lot Inspection</h1>
				  {%  if msg %}<div style="font-weight: bold; color:green; font-size: 12px;">{{ msg }}</div>{%  endif %}
				</div>
                <div class="grid-x grid-padding-x align-middle">
				    {% csrf_token %}
                    <div class="cell large-6 medium-6 small-12">
                      <label>Lot#:</label>
                        <input type="text" id="wo_number" name="wo_number" value="{{ wo_number }}">										  
                    </div>
                    <div class="cell large-6 medium-6 small-12">
                      <label>P/N:</label>
                        {{ form.part_number }}										  
                    </div>
                    <div class="cell large-6 medium-6 small-12">
                      <label>Desc:</label>
                        {{ form.description }}										  
                    </div>
					<div class="cell large-6 medium-6 small-12">
					  <label>Status:</label>
					  <select style="background-color:#284a8a;color:white;" name="stock_status" id="stock_status">
						<option value="">--No Selection--</option>
						{% for status in statuses  %}
                          {% if status.wos_auto_key == stock_status %}
						  <option value="{{ status.wos_auto_key }}" checked="checked">
						    {{ status.name }}
						  </option>
						  {% else %} 						
						  <option value="{{ status.wos_auto_key }}">
						    {{ status.name }}
						  </option>
                          {% endif %}						  
						{% endfor %}
					  </select>
					</div>
					<div class="cell large-6 medium-6 small-12">
					  <label>Cons:</label>
					  <input type="text" list="cons_list" name="consignment" id="consignment"/>
					  <datalist id="cons_list">
						{% for cons in cons_codes %}							
						<option value="{{ cons.code }}">{{ cons.code }}</option>						
						{% endfor %}
					  </datalist>
					</div>
                    <div class="cell large-6 medium-6 small-12">
                      <label>S/N:</label>
                        {{ form.serial_number }}										  
                    </div>
					<div class="cell large-6  medium-6 small-12 mro-searchbuttonbox">
					  <input class="secondary button shadow" type="submit" value="SEARCH" name="lot_search" id="lot_search" onclick="this.disabled=true,this.form.submit();"/> 
				    </div>
				</div>
              </div>
			</div>	
		</div>      
	</div>
  </div>
<script>
$(function() {
    $("#updateModal").modal();//if you want you can have a timeout to hide the window after x seconds
	//$("#upd_mfg").kendoDateTimePicker();
	//$("#upd_tag").kendoDateTimePicker();
});
</script>
    <!-- Modal Update Status and Notes -->
    {% if show_modal == 'T' %}
    <div class="modal fade" id="updateModal" role="dialog">
        <div class="modal-dialog" style="width:70%;">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Update Stock</h4>
            </div>
            <div class="modal-body">
                <form method="POST" id="update_form" enctype="multipart/form-data" name="update_form">
                  {% csrf_token %}
				  <input type="hidden" name="update_session" id="update_session" value="{{ session_id }}"/>
				  <input type="hidden" name="user_auto_key" id="user_auto_key" value="{{ sysur_auto_key }}"/>
				  <input type="hidden" name="filter_serial"  id="filter_serial" value="{{ serial_number }}"/>
				  <input type="hidden" name="filter_status" id="filter_status" value="{{ stock_status }}"/>
				  <input type="hidden" name="filter_wo" id="filter_wo" value="{{ wo_number }}"/>
				  <input type="hidden" name="filter_pn" id="filter_pn" value="{{ part_number }}"/>
				  <input type="hidden" name="filter_desc"  id="filter_desc" value="{{ description }}"/>
				  <input type="hidden" name="filter_desc"  id="filter_cons" value="{{ consignment }}"/>
				  {% for stm in lot_list %}
				     <input type="hidden" name="lot_sels[]" id="lot_sels[]" value="{{ stm }}" checked="checked"/>
				  {% endfor %}
				  <div class="mro-lightsearch">
					<div class="grid-x grid-padding-x">
						<div class="large-6 small-12 cell" style="width:100%;">
						  <div class="grid-x grid-padding-x align-middle">
						  	<div class="cell large-4 medium-6 small-12">
							  <label>SLs:</label>
							  <input readonly=1 type="text" name="sl_list" id="sl_list" value="{{ sl_list }}"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label style="color:white">dummy</label>
							  <input style="background-color:white;border:none;" readonly=1 type="text" name="dummy"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label style="color:white">dummy</label>
							  <input style="background-color:white;border:none;" readonly=1 type="text" name="dummy"/>
							</div>
	                        <div class="cell large-4 medium-6 small-12">
							  <label>PN:</label>
							  <input readonly=1 type="text" name="prod_pn" id="prod_pn" value="{{ prod_pn }}"/>
							</div>
	                        <div class="cell large-4 medium-6 small-12">
							  <label>Desc:</label>
							  <input readonly=1 type="text" name="prod_desc" id="prod_desc" value="{{ prod_desc }}"/>
							</div>
	                        <div class="cell large-4 medium-6 small-12">
							  <label>Cons:</label>
							  <input readonly=1 type="text" name="prod_cons" id="prod_cons" value="{{ prod_cons }}"/>
							</div>
	                        <div class="cell large-4 medium-6 small-12">
							  <label>Location:</label>
							  <input type="text" list="loc_list" name="upd_loc" id="upd_loc"/>
							  <datalist id="loc_list">
							    <option value="">--No Selection--</option>
							    {% for loc in locations %}	                              								
								<option value="{{ loc.location_code }}">{{ loc.location_code }}</option>						
								{% endfor %}
							  </datalist>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Qty:</label>
							  <input type="text" name="upd_qty" id="upd_qty"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Obtained From:</label>
							  <!--select style="background-color:#284a8a;color:white;" name="upd_obtained" id="upd_obtained"-->
							  <input type="text" list="obtained_from" id="upd_obtained" name="upd_obtained"/>
							  <datalist id="obtained_from">
							    <option value="">--No Selection--</option>
							    {% for cmp in companies %}	                              								
								<option value="{{ cmp.name }}">{{ cmp.name }}</option>						
								{% endfor %}
							  </datalist>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Actual PN:</label>
							  <input type="text" name="upd_alt_pn" id="upd_alt_pn"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>MFG:</label>
							  <input type="text" name="upd_mfctr" id="upd_mfctr"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Traceability:</label>
							  <input type="text" name="upd_trac" id="upd_trac"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>S/N:</label>
							  <input type="text" name="upd_sn" id="upd_sn"/>
							</div>
	                        <div class="cell large-4 medium-6 small-12">
							  <label>MFG Date:</label>
							  <input type="text" name="upd_mfg" id="upd_mfg" value="{{ upd_mfg }}"/>
							</div>
	                        <div class="cell large-4 medium-6 small-12">
							  <label>Tagged By:</label>
							  <!--select style="background-color:#284a8a;color:white;" name="upd_tagged" id="upd_tagged"-->
							  <input type="text" list="tagged_by" id="upd_tagged" name="upd_tagged"/>
					          <datalist id="tagged_by">
							    <option value="">--No Selection--</option>
							    {% for cmp in companies %}	                              								
								<option value="{{ cmp.name }}">{{ cmp.name }}</option>						
								{% endfor %}
							  </datalist>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Remarks:</label>
							  <textarea type="text" name="upd_remarks" id="upd_remarks"></textarea>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Country of Origin:</label>
							  <input type="text" name="upd_ctry_origin" id="upd_ctry_origin"/>
							</div>
	                        <div class="cell large-4 medium-6 small-12">
							  <label>Tag Date:</label>
							  <input type="text" name="upd_tag" id="upd_tag" value="{{ upd_tag }}"/>
							</div>
	                        <!--div class="cell large-4 medium-6 small-12">
							  <label>Traceable To:</label>
							  <input type="text" list="traceable_to" name="upd_traceable" id="upd_traceable"/>
							  <datalist id="traceable_to">
							    <option value="">--No Selection--</option>
							    {% for cert in cert_codes %}	                              								
								<option value="{{ cert.name }}">{{ cert.name }}</option>						
								{% endfor %}
							  </datalist>
							</div-->						  
                            <div class="cell large-4 medium-6 small-12">
							  <label>Hold:</label>
							  <input type="checkbox" name="upd_hold" id="upd_hold" value="T"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Condition:</label>
							  <select style="background-color:#284a8a;color:white;" name="upd_cond_code" id="upd_cond_code">
							    <option value="">--No Selection--</option>
							    {% for cond in conditions %}	                              								
								<option value="{{ cond.condition_code }}">{{ cond.condition_code }}</option>						
								{% endfor %}
							  </select>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Status:</label>
							  <select style="background-color:#284a8a;color:white;" name="upd_status" id="upd_status">
								<option value="">--No Selection--</option>
								{% for status in statuses  %}	                              								
								<option value="{{ status.wos_auto_key }}">{{ status.name }}</option>						
								{% endfor %}
							  </select>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>TSO/CSO:</label>
							  <input type="text" name="upd_tso_cso" id="upd_tso_cso"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>TSN/CSN:</label>
							  <input type="text" name="upd_tsn_csn" id="upd_tsn_csn"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Notes:</label>
							  <textarea type="text" name="upd_notes" id="upd_notes"></textarea>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Inspection Date:</label>
							  <input type="text" name="upd_insp_date" id="upd_insp_date"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Cure Date:</label>
							  <input type="text" name="upd_cure_date" id="upd_cure_date"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							  <label>Exp Date:</label>
							  <input type="text" name="upd_exp_date" id="upd_exp_date"/>
							</div>
							<!--div class="cell large-4 medium-6 small-12">
							  <label>Tag Type:</label>
							  <input type="text" list="tag_type_list" id="upd_tag_type" name="upd_tag_type"/>
					          <datalist id="tag_type_list">
								<option value="">--No Selection--</option>
								{% for tag_type in tag_types  %}	                              								
								<option value="{{ tag_type.name }}">{{ tag_type.name }}</option>						
								{% endfor %}
							  </datalist>
							</div-->
							 <div class="cell large-6 medium-6 small-12">
								<label>Image Import:</label>
								<input type="file" id="img_file" name="img_file" accept="image/*,.pdf"/>
							</div>
							<div class="cell large-4 medium-6 small-12">
							   <button class="primary button shadow" name="update_submitted" id="update_submitted" value="1" type="submit">Update</button>
							</div>
						  </form>  
						  </div>
						</div>
						</div>
					  </div>
					</div>
				  </div>
			  </div>
		</div>
	</div>
	{% endif %}
	<!-- Modal Error Pop-up -->
	<script>
		$('#upd_mfg').datepicker({
			weekStart: 1,
			daysOfWeekHighlighted: "6,0",
			autoclose: true,
			todayHighlight: true,
			});
		$('#upd_tag').datepicker({
			weekStart: 1,
			daysOfWeekHighlighted: "6,0",
			autoclose: true,
			todayHighlight: true,
			});
		$('#upd_exp_date').datepicker({
			weekStart: 1,
			daysOfWeekHighlighted: "6,0",
			autoclose: true,
			todayHighlight: true,
			});
		$('#upd_cure_date').datepicker({
			weekStart: 1,
			daysOfWeekHighlighted: "6,0",
			autoclose: true,
			todayHighlight: true,
			});
		$('#upd_insp_date').datepicker({
			weekStart: 1,
			daysOfWeekHighlighted: "6,0",
			autoclose: true,
			todayHighlight: true,
			});
	$(function() {
		$("#errorModal").modal();//if you want you can have a timeout to hide the window after x seconds
	});
	</script>
    <!-- Modal -->
    {%  if error %}
      <div class="modal fade" id="errorModal" role="dialog" data-backdrop="static">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
		    <form method="POST" id="modal_error_form" name="modal_error_form">
            <div class="modal-header">
              <button type="button" class="close" id="x_button" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Application Message:</h4>
            </div>
            <div class="modal-body">
			    <input type="hidden" id="error" name="error" value="{{ error }}"/><div style="font-weight: bold; color:red; font-size: 22px;">{{ error }}</div>
                <button class="secondary button shadow" id="ok_button" style="float:right; margin-top:-20px;" type="button" data-dismiss="modal">OK</button>
                <div><br/><br/></div>			
            </div>
			</form>
          </div>                
       </div>
      </div>
	  {% endif %}  
    <!-- End modal error popup -->
	<!-- Modal Error Pop-up -->
	<script>
	$(function() {
		$("#labelModal").modal();//if you want you can have a timeout to hide the window after x seconds
	});
	</script>
    <!-- Modal -->
    {%  if show_modal == 'label' %}
      <div class="modal fade" id="labelModal" role="dialog" data-backdrop="static">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
		    <form method="POST" id="print_diag" name="print_diag" target="_blank">
			    {% csrf_token %}
				<input type="hidden" name="yes_print" id="yes_print" value="0"/>
				<input type="hidden" name="no_print" id="no_print" value="0"/>
				<input type="hidden" id="filter_wo" name="filter_wo" value="{{ wo_number }}"/>
				<input type="hidden" id="update_pn" name="update_pn" value="{{ update_pn }}"/>
				<input type="hidden" id="filter_session" name="filter_session" value="{{ session_id }}"/>
			    {% for stm in lot_list %}
				  <input type="hidden" name="lot_sels[]" id="lot_sels[]" value="{{ stm }}" checked="checked"/>
			    {% endfor %}
				<div class="modal-header">
				  <button type="button" class="close" id="x_button" data-dismiss="modal">&times;</button>
				  <h4 class="modal-title">Print Part Label?</h4>
				</div>
				<div class="modal-body">
					<input class="secondary button shadow" id="yes_button" name="yes_button" value="Yes" style="float:left; margin-top:-15px;" type="submit">
					<input class="secondary button shadow" id="no_button" name="no_button" value="No" style="margin-top:-15px;" type="submit">
					<div><br/><br/></div>			
				</div>
			</form>
          </div>                
       </div>
      </div>
	  {% endif %}  
    <!-- End modal error popup --> 
	<div class="mro-bottom-section-wrapper mro-table">
      <div class="grid-container mro-bottom-section">
	      <div class="grid-x grid-padding-x">
				{% if total_rows and total_rows != '0' %}
					<div class="centered results_grid" id="results_grid" name="results_grid">
					<div class="counter_wrap">					  
					  <input type="button" id="select_all" class="secondary button shadow" style="margin-left:-45px;padding:9px;" value="SELECT ALL"/>
					  <input type="button" id="accept" name="accept" class="primary button shadow" style="padding:9px;" value="ACCEPT"/>
					  <input type="button" id="update" name="update" class="primary button shadow" style="padding:9px;" value="UPDATE"/>
					  <input type="text" class="sel_rows" id="sel_rows" name="sel_rows" size="4" value="{{ sel_rows }}" readonly>of     <input type="text" class="total_rows" id="total_rows" name="total_rows" value="{{ total_rows }}" size="5" readonly>
					</div>			
			<script>
			kendo.ui.Grid.prototype._positionColumnResizeHandle= function() {
			  var that = this,
				  indicatorWidth = that.options.columnResizeHandleWidth,
				  lockedHead = that.lockedHeader ? that.lockedHeader.find("thead:first") : $();

			  that.thead.add(lockedHead).on("mousemove" + ".kendoGrid", "th", function (e) {
				var th = $(this);
				if (th.hasClass("k-group-cell") || th.hasClass("k-hierarchy-cell")) {
				  return;
				}
				that._createResizeHandle(th.closest("div"), th);
			  });
			};
			var oldPageSize = 0;
			$( "#select_all" ).click(function() {
			    var grid = $("#results_grid").data("kendoGrid");
				if (grid.dataSource.data().length === grid.select().length) {
					grid.clearSelection();
					$("input[type=hidden][class='wobs']").remove();	
					$('#sel_rows').val(0);
				} 
				else {
					grid.select("tr");
				};
			});
			function onChange(e) {
				var rows = e.sender.select();
				var grid = $("#results_grid").data("kendoGrid");
				var currentPage = grid.dataSource.page();
				//console.log('current page: ' + currentPage + 'selected: ' + rows.length);
				//first it goes to woos_first and then onchange again, it goes to woos
				$("input[type=hidden][uipage='" + currentPage + "']").attr('class', 'wobs_stale'); 
				rows.each(function(e) {
					var dataItem = grid.dataItem(this);					
					var row_item = $('input[type=hidden][class="wobs"][value=' + dataItem.id + ']').length;
                    if (!row_item) {
						var input_wob = '<input type="hidden" uipage="' + currentPage + '" name="lot_list[]" id="lot_list[]" class="wobs" value="' + dataItem.id + '" checked=checked"/>';
						$('#session_id').after(input_wob);					
					}
				var count = $("input[type=hidden][class='wobs']").length;					
				$('#sel_rows').val(count);					
			    $("input[type=hidden][uipage='" + currentPage + "'][class='wobs_stale']").remove();				
				});	
			};
			$(document).ready(
				function () {				
					var dataSourceArguments = {	
					    autoBind: false,
						pageSize: 10,
						serverPaging: true,
						serverSorting: true,
						transport: {
							read: {
								url: '/portal/json',
								dataType: "json",
								data: { 'user_id': '{{ user_id }}','session_id': '{{ session_id }}','is_wos': '1' } // the parameter I need to send to the server
							}
						},
						schema: {
							total: "count",
							data: "results",
							model: { id: "stm_auto_key" },
						}
					}
					
					var dsg = new kendo.data.DataSource(dataSourceArguments);
					var options = localStorage["grid-options"];
					$("#results_grid").kendoGrid({
					    toolbar: ["excel"],
						excel: {
							fileName: "lot-inspection-export.xlsx",
							proxyURL: "https://demos.telerik.com/kendo-ui/service/export",
							allPages: true
						},
						dataSource: dsg,
						sortable: true,
						reorderable: true,
						resizable: true,
                        selectable: "multiple, row",
						persistSelection: true,
                        navigatable: false,
						change: onChange,
						pageable: {
							refresh: true,
							pageSizes: true,
							buttonCount: 5,
						},
                        columns: [
							{
							  field: 'wo_number',
							  title: 'LOT',
							  width: screen.availWidth*0.07
							},
							{
							  field: 'stock_line',
							  title: 'SL#',
							  width: screen.availWidth*0.07
							},								
							{
							  field: 'part_number',
							  title: 'PN',
							  width: screen.availWidth*0.07
							},
							{
							  field: 'description',
							  title: 'DESC',
							  width: screen.availWidth*0.07
							},
							{
							  field: 'rack',
							  title: 'SERIAL#',
							  width: screen.availWidth*0.07
							},
							{
							  field: 'status',
							  title: 'STATUS',
							  width: screen.availWidth*0.08
							},
							{
							  field: 'qty_needed',
							  title: 'QTY EXP',
                              width: screen.availWidth*0.09					  
							},
							{
							  field: 'qty_oh',
							  title: 'QTY INSP',
                              width: screen.availWidth*0.09					  
							},
							{
							  field: 'condition_code',
							  title: 'COND',
                              width: screen.availWidth*0.09					  
							},
							{
							  field: 'cond_level_zero',
							  title: 'STK COND',
                              width: screen.availWidth*0.09					  
							},
							{
							  field: 'account_company',
							  title: 'READY',
                              width: screen.availWidth*0.09,
                              template: '<img src="/static/#=account_company#"/>',							  
							},
							{
							  field: 'notes',
							  title: 'NOTES',
                              width: screen.availWidth*0.09					  
							},
					    ],								
					});
					$("select[data-role='dropdownlist']").kendoDropDownList({
						dataTextField: "pageSize",
						dataValueField: "sizeValue",
						dataSource: [
							{pageSize: 25},
							{pageSize: 50},
							{pageSize: 100},
							{pageSize: 500},
							{pageSize: 2000},
							{pageSize: 'All', sizeValue:10000},
						],
					});
					   
					// Enable select on click to allow for mobile selection of different rows
					$("#results_grid tbody").on("click", "tr", function(e) {
						var rowElement = this;
						var row = $(rowElement);
						var grid = $("#results_grid").getKendoGrid();

						if (row.hasClass("k-state-selected")) {
							var selected = grid.select();

							selected = $.grep(selected, function(x) {
								var itemToRemove = grid.dataItem(row);
								var currentItem = grid.dataItem(x);
			                    //$row.removeClass("k-selected");
								return itemToRemove.id != currentItem.id
							})
							
							var sel_rows = $('#sel_rows').val();
							$('#sel_rows').val(sel_rows);
							grid.clearSelection();
							grid.select(selected);
							if (selected==false) {
							    $('#sel_rows').val(0);
							}
							
							// Stop propagation to prevent Kendo's default selection behavior
							e.stopPropagation();

						}
						else {
							grid.select(row)
							e.stopPropagation();
						}
					});
				});
			  </script>
	            </div>	
			{% endif %}
		  </div>
        <div class="grid-x mro-pagination-section">
		    {% if total_rows and total_rows != '0' %}
		    <input type="button" id="bottom_accept" name="bottom_accept" class="primary button shadow" style="padding:9px;" value="ACCEPT"/>
			<input type="button" id="bottom_update" name="bottom_update" class="primary button shadow" style="padding:9px;" value="UPDATE"/>
            {% endif %}
          <div class="cell large-5 medium-6 small-12 ">
            <a class="mrotop" href="#mrotop" data-smooth-scroll><span>^</span> Back to Top</a>
          </div>
        </div>		  
	    </div>
	  </div>				
<div class="mro-footer-wrapper">
	<div class="grid-container mro-footer">
		<div class="grid-x">
			<div class="cell small-12">
				<img class="mro-footerlogo" src="{% static 'dist/assets/img/mro-live_header.png' %}" alt="Where Productivity Takes Flight" alt="MRO Live - Where Productivity Takes Flight">
			</div>
		</div>

		<div class="grid-x mro-footer-bottom">
			<div class="cell medium-5 small-12 mro-footer-bottom-left">
				<p>Copyright &copy; 2025 MRO Live <span>|</span> <img class="mro-usa" src="{% static 'dist/assets/img/usa.png' %}" alt="Based in USA">Based in USA</p>
			</div>
		</div>
	</div>
</div><script src="{% static 'dist/assets/js/app.js' %}"></script>
</body>
</html>
